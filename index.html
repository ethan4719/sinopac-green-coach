<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è·æ¥­é‹å‹•ç¶“ç†äººï¼šå‘½é‹è¼ªç›¤ç‰ˆ (Mobile)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
            /* é˜²æ­¢æ‰‹æ©Ÿä¸‹æ‹‰åˆ·æ–°å½±éŸ¿éŠæˆ²é«”é©— */
            overscroll-behavior-y: none;
        }

        .title-font { font-family: 'Fredoka', sans-serif; }

        .game-card {
            background: white;
            border-radius: 20px; /* æ‰‹æ©Ÿä¸Šåœ“è§’ç¨å¾®ç¸®å°ä¸€é» */
            box-shadow: 0 4px 15px -3px rgba(0, 0, 0, 0.05);
            border: 2px solid #e2e8f0;
            transition: transform 0.2s;
        }

        .btn-action {
            transition: all 0.2s;
            border-bottom: 4px solid rgba(0,0,0,0.1);
            /* å¢åŠ æ‰‹æ©Ÿé»æ“Šå€åŸŸ */
            min-height: 44px; 
        }
        .btn-action:active {
            transform: translateY(2px);
            border-bottom-width: 0px;
        }

        /* è¼ªç›¤éŸ¿æ‡‰å¼èª¿æ•´ */
        .wheel-container {
            /* æ‰‹æ©Ÿç‰ˆï¼šä½¿ç”¨ç›¸å°å¯¬åº¦ */
            width: 75vw; 
            height: 75vw;
            /* é›»è…¦ç‰ˆï¼šé™åˆ¶æœ€å¤§å°ºå¯¸ */
            max-width: 300px;
            max-height: 300px;
            border-radius: 50%;
            border: 6px solid white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            margin: 0 auto; /* ç½®ä¸­ */
        }
        
        .wheel-segment {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            clip-path: polygon(50% 50%, 100% 0, 100% 100%);
            background: conic-gradient(
                #FF8B94 0deg 60deg,
                #FFAAA5 60deg 120deg,
                #FFD3B6 120deg 180deg,
                #DCEDC1 180deg 240deg,
                #A8E6CF 240deg 300deg,
                #84D0FF 300deg 360deg
            );
        }

        .wheel-pointer {
            width: 0;
            height: 0; 
            border-left: 12px solid transparent; /* ç¨å¾®ç¸®å° */
            border-right: 12px solid transparent;
            border-top: 24px solid #334155;
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
        }

        .bar-fill { transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* è‡ªå®šç¾©æ»¾å‹•æ¢éš±è—ä½†å¯æ»¾å‹• */
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-4 px-3 md:py-6 md:px-4">

    <div class="text-center mb-4">
        <h1 class="text-2xl md:text-5xl font-bold text-slate-700 title-font tracking-wide mb-1">
            <i class="fa-solid fa-medal text-yellow-400 mr-1"></i>è·æ¥­é‹å‹•ç¶“ç†äºº
        </h1>
        <p class="text-slate-500 text-xs md:text-base font-medium bg-white px-3 py-0.5 rounded-full inline-block shadow-sm">
            æ™¯è§€ç¤¾æœƒç¯‡ â€¢ å‘½é‹è¼ªç›¤ç‰ˆ
        </p>
    </div>

    <div id="game-container" class="w-full max-w-5xl relative pb-20"> <div class="game-card p-3 mb-4 grid grid-cols-2 gap-3 md:grid-cols-4 md:gap-6 sticky top-0 z-40 bg-white/95 backdrop-blur shadow-md">
            <div class="flex flex-col">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase">ç‡Ÿé‹è³‡é‡‘</span>
                    <i class="fa-solid fa-sack-dollar text-emerald-500 text-sm"></i>
                </div>
                <div class="w-full bg-slate-100 h-2 md:h-3 rounded-full overflow-hidden">
                    <div id="bar-funds" class="bar-fill h-full bg-emerald-400 rounded-full" style="width: 50%"></div>
                </div>
            </div>

            <div class="flex flex-col">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase">æ­»å¿ çƒè¿·</span>
                    <i class="fa-solid fa-glasses text-blue-500 text-sm"></i>
                </div>
                <div class="w-full bg-slate-100 h-2 md:h-3 rounded-full overflow-hidden">
                    <div id="bar-purists" class="bar-fill h-full bg-blue-400 rounded-full" style="width: 50%"></div>
                </div>
            </div>

            <div class="flex flex-col">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase">å¨›æ¨‚ç²‰çµ²</span>
                    <i class="fa-solid fa-camera text-rose-400 text-sm"></i>
                </div>
                <div class="w-full bg-slate-100 h-2 md:h-3 rounded-full overflow-hidden">
                    <div id="bar-casuals" class="bar-fill h-full bg-rose-400 rounded-full" style="width: 50%"></div>
                </div>
            </div>

            <div class="flex flex-col">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[10px] md:text-xs font-bold text-slate-400 uppercase">çƒéšŠæˆ°ç¸¾</span>
                    <i class="fa-solid fa-trophy text-amber-500 text-sm"></i>
                </div>
                <div class="w-full bg-slate-100 h-2 md:h-3 rounded-full overflow-hidden">
                    <div id="bar-skill" class="bar-fill h-full bg-amber-400 rounded-full" style="width: 50%"></div>
                </div>
            </div>
        </div>

        <div class="flex flex-col md:grid md:grid-cols-12 gap-4 md:gap-6">
            
            <div class="order-1 md:order-2 md:col-span-8">
                <div id="card-area" class="game-card p-5 md:p-8 h-full flex flex-col justify-between relative min-h-[350px] md:min-h-[450px]">
                    
                    <div class="hidden md:block absolute right-4 top-4 opacity-10 text-9xl text-slate-300 pointer-events-none">
                        <i id="bg-icon" class="fa-solid fa-clipboard-question"></i>
                    </div>

                    <div class="z-10 mt-1">
                        <div class="flex justify-between items-start">
                            <span id="card-category" class="inline-block px-3 py-1 rounded-lg bg-orange-100 text-orange-500 text-[10px] md:text-xs font-bold mb-3">
                                ç®¡ç†æ±ºç­–
                            </span>
                            <span class="md:hidden text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-full">
                                ç¬¬ <span id="mobile-turn-display">1</span>/10 å­£
                            </span>
                        </div>
                        
                        <h2 id="card-title" class="text-xl md:text-3xl font-bold mb-3 text-slate-800 leading-tight">æº–å‚™å¥½é–‹å§‹äº†å—ï¼Ÿ</h2>
                        <p id="card-desc" class="text-base md:text-lg text-slate-600 leading-relaxed">
                            æ¯ä¸€å€‹æ±ºå®šéƒ½æœƒå½±éŸ¿çƒéšŠçš„æœªä¾†ã€‚è«‹è¬¹æ…é¸æ“‡ä½ çš„ç¶“ç‡Ÿè·¯ç·šã€‚
                        </p>
                    </div>

                    <div class="grid grid-cols-1 gap-3 z-10 mt-6" id="choices-container">
                        </div>
                </div>
            </div>

            <div class="order-2 md:order-1 md:col-span-4 space-y-4">
                <div class="hidden md:block game-card p-6 text-center bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-100">
                    <h2 class="text-slate-400 text-xs font-bold uppercase mb-2">ç•¶å‰è³½å­£</h2>
                    <div class="text-6xl title-font font-bold text-slate-700 relative inline-block">
                        <span id="turn-display">1</span>
                        <span class="text-2xl text-slate-400 absolute -right-8 top-0">/10</span>
                    </div>
                    <div class="mt-4 text-sm text-indigo-500 font-bold bg-indigo-100 py-1 px-3 rounded-full inline-block">
                        <i class="fa-solid fa-bullseye mr-1"></i> ç›®æ¨™ï¼šå­˜æ´» 10 å­£
                    </div>
                </div>

                <div class="game-card p-4 md:p-5 flex flex-col h-64 md:h-80">
                    <h3 class="text-slate-600 font-bold mb-3 flex items-center text-sm md:text-base">
                        <i class="fa-regular fa-newspaper mr-2 text-slate-400"></i>
                        çƒåœ˜æ—¥èªŒ
                    </h3>
                    <div id="log-container" class="overflow-y-auto flex-1 text-sm space-y-2 pr-1 custom-scroll text-slate-500">
                        <p class="bg-slate-50 p-2 rounded-lg border border-slate-100 text-xs md:text-sm">
                            ğŸ‘‹ æ­¡è¿ä¾†åˆ°ç¸½ç¶“ç†è¾¦å…¬å®¤ï¼
                        </p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div id="wheel-modal" class="fixed inset-0 bg-slate-900/90 z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-300 backdrop-blur-sm px-4">
        <div class="bg-white p-6 md:p-8 rounded-3xl w-full max-w-md text-center shadow-2xl transform scale-95 transition-transform duration-300 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-blue-50 to-transparent -z-0"></div>
            
            <h2 class="text-xl md:text-2xl font-bold text-slate-700 mb-1 relative z-10">å‘½é‹å¤§è¼ªç›¤ï¼</h2>
            <p class="text-sm text-slate-500 mb-4 relative z-10">ç¤¾æœƒè®Šå› ä¸å¯é æ¸¬...</p>
            
            <div class="relative flex justify-center mb-6">
                <div class="wheel-pointer"></div>
                <div class="wheel-container" id="wheel">
                    <div class="wheel-segment"></div>
                </div>
            </div>

            <button id="spin-btn" onclick="spinWheel()" class="btn-action bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-8 rounded-full text-base md:text-lg shadow-lg w-full">
                <i class="fa-solid fa-rotate mr-2"></i> è½‰å‹•å‘½é‹ï¼
            </button>
            
            <div id="wheel-result" class="hidden mt-4 bg-indigo-50 p-3 rounded-xl border border-indigo-100 animate-bounce">
                <h3 class="font-bold text-indigo-600 text-lg" id="wheel-event-title">äº‹ä»¶æ¨™é¡Œ</h3>
                <p class="text-sm text-slate-600" id="wheel-event-desc">äº‹ä»¶æè¿°</p>
                <button onclick="closeWheel()" class="mt-2 text-sm text-indigo-400 hover:text-indigo-600 underline py-2">ç¹¼çºŒéŠæˆ²</button>
            </div>
        </div>
    </div>

    <div id="game-over-modal" class="fixed inset-0 bg-slate-900/90 z-50 flex items-center justify-center hidden px-4">
        <div class="bg-white p-6 md:p-8 rounded-3xl w-full max-w-md text-center shadow-2xl">
            <div class="text-5xl md:text-6xl mb-4" id="end-icon">ğŸ</div>
            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-2" id="end-title">éŠæˆ²çµæŸ</h2>
            <p class="text-slate-500 mb-6 text-sm md:text-base" id="end-message">...</p>
            <div class="bg-slate-50 p-4 rounded-xl text-left mb-6 text-xs md:text-sm text-slate-600 border border-slate-100">
                <p class="font-bold text-slate-700 mb-2">ğŸ“Š é«”è‚²ç¤¾æœƒå­¸å®¶è©•è«–ï¼š</p>
                <p id="end-critique">...</p>
            </div>
            <button onclick="restartGame()" class="btn-action bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full w-full">
                <i class="fa-solid fa-rotate-right mr-2"></i> é‡æ–°é–‹å§‹
            </button>
        </div>
    </div>

    <script>
        // --- éŠæˆ²æ•¸æ“šèˆ‡è…³æœ¬ ---
        const scenarios = [
            {
                id: "cheerleaders",
                category: "æ™¯è§€è¡ŒéŠ·",
                title: "éŸ“å¼æ‡‰æ´ä¾†è¥²ï¼",
                desc: "å°æ‰‹å¼•é€²äº†è¶…å¼·å•¦å•¦éšŠï¼Œçƒå ´è®Šæˆäº†å¤§å‹å¤œåº—ã€‚æˆ‘å€‘çš„çƒå ´å¾ˆå®‰éœï¼Œä½†ç¥¨è³£ä¸å‹•äº†ã€‚è€é—†å•ä½ è¦ä¸è¦è·Ÿé€²ï¼Ÿ",
                icon: "fa-bullhorn",
                choices: [
                    {
                        text: "è·Ÿé€²ï¼å…¨å¥—é›»éŸ³ï¼‹å•¦å•¦éšŠ",
                        effect: { funds: -15, purists: -20, casuals: +40, skill: -5 },
                        log: "ğŸ”Š ä½ æ‰“é€ äº†è¶…åµçš„ä¸»å ´ã€‚è³‡æ·±çƒè¿·æ°£è·‘äº†ï¼Œä½†ä¸€æ—¥çƒè¿·æŠŠç¥¨æ¶å…‰äº†ã€‚"
                    },
                    {
                        text: "ä¸è¦ï¼Œæˆ‘å€‘å°ˆæ³¨æ¯”è³½",
                        effect: { funds: -5, purists: +15, casuals: -15, skill: +5 },
                        log: "âš¾ çƒå ´å†·æ¸…ï¼Œç‡Ÿæ”¶ä¸‹æ»‘ï¼Œä½†ç•™ä¸‹çš„çƒè¿·èªªé€™æ˜¯ã€Œæœ€å¾Œçš„æ·¨åœŸã€ã€‚"
                    }
                ]
            },
            {
                id: "star_player",
                category: "çƒæ˜Ÿæ“ä½œ",
                title: "èª°æ˜¯ä½ çš„çœ‹æ¿çƒæ˜Ÿï¼Ÿ",
                desc: "ä½ éœ€è¦ä¸€ä½çƒæ˜Ÿä¾†æ•‘ç¥¨æˆ¿ã€‚ç¾åœ¨æœ‰å…©å€‹é¸æ“‡ï¼šä¸€ä½æ˜¯å¯¦åŠ›æ™®æ™®çš„ç¶²ç´…çƒå“¡ï¼Œä¸€ä½æ˜¯å¿«é€€ä¼‘çš„å‚³å¥‡è€å°‡ã€‚",
                icon: "fa-user-astronaut",
                choices: [
                    {
                        text: "ç°½å‚³å¥‡è€å°‡ (è³£æƒ…æ‡·)",
                        effect: { funds: -10, purists: +25, casuals: +5, skill: +5 },
                        log: "ğŸ¦ã€Œé‡ç¸ã€å›æ­¸ï¼æ‡·èˆŠè¡ŒéŠ·å¤§æˆåŠŸï¼Œè€çƒè¿·éƒ½æ„Ÿå‹•å“­äº†ã€‚"
                    },
                    {
                        text: "ç°½ç¶²ç´…çƒå“¡ (è³£æµé‡)",
                        effect: { funds: +10, purists: -15, casuals: +30, skill: -15 },
                        log: "ğŸ“± ç¶²ç´…çƒå“¡å¸¶ä¾†å·¨å¤§æµé‡ï¼Œä½†ä»–åœ¨å ´ä¸Šå¤±èª¤é€£é€£ï¼Œæ•™ç·´å¾ˆé ­ç—›ã€‚"
                    }
                ]
            },
            {
                id: "nil_deal",
                category: "èº«é«”ç¶“æ¿Ÿ",
                title: "çˆ­è­°æ€§çš„å…§è¡£å»£å‘Š",
                desc: "ä½ çš„ç‹ç‰Œé¸æ‰‹æ”¶åˆ°ä¸€ä»½é«˜é¡çš„å…§è¡£ä»£è¨€é‚€ç´„ã€‚é€™èƒ½è³ºå¤§éŒ¢ï¼Œä½†ä¿å®ˆæ´¾æ‰¹è©•é€™æ˜¯ã€Œç‰©åŒ–é‹å‹•å“¡ã€ã€‚",
                icon: "fa-shirt",
                choices: [
                    {
                        text: "æ¥ï¼é€™æ˜¯NILæ¬Šåˆ©",
                        effect: { funds: +20, purists: -10, casuals: +15, skill: -5 },
                        log: "ğŸ“¸ å»£å‘Šçœ‹æ¿æ»¿è¡—éƒ½æ˜¯ã€‚çƒå“¡è®Šæˆäº†æ€§æ„Ÿç¬¦è™Ÿï¼Œä½†å¤–å‹™å¤ªå¤šå½±éŸ¿è¨“ç·´ã€‚"
                    },
                    {
                        text: "æ‹’çµ•ï¼Œä¿æŒå½¢è±¡",
                        effect: { funds: -5, purists: +10, casuals: -5, skill: +10 },
                        log: "ğŸ›¡ï¸ ä½ æ‹’çµ•äº†é‡‘éŒ¢èª˜æƒ‘ã€‚çƒå“¡ä¿æŒäº†è‹¦è¡Œåƒ§èˆ¬çš„å°ˆæ³¨ï¼Œå‚™å—å°Šæ•¬ã€‚"
                    }
                ]
            },
            {
                id: "merch_fetish",
                category: "è£å‚™æ‹œç‰©æ•™",
                title: "è¦è³£ä»€éº¼å‘¨é‚Šï¼Ÿ",
                desc: "è¡ŒéŠ·éƒ¨æƒ³æ¨æ–°å•†å“ã€‚è¦è³£è¶…è²´çš„ã€Œé¸æ‰‹åŒæ¬¾é ‚ç´šè»Šã€ï¼Œé‚„æ˜¯ä¾¿å®œçš„ã€Œæ¨å»£ç‰ˆã€ï¼Ÿ",
                icon: "fa-bicycle",
                choices: [
                    {
                        text: "è³£è¶…è²´é ‚ç´šæ¬¾ (å‰²éŸ­èœ)",
                        effect: { funds: +30, purists: -10, casuals: +5, skill: 0 },
                        log: "ğŸ’° ä¸­ç”¢éšç´šç˜‹ç‹‚æ¶è³¼ï¼Œå³ä¾¿ä»–å€‘é¨ä¸å‡ºå·®åˆ¥ã€‚ä½ è³ºç¿»äº†ã€‚"
                    },
                    {
                        text: "è³£å¹³åƒ¹æ¨å»£ç‰ˆ (åšå…¬ç›Š)",
                        effect: { funds: +5, purists: +5, casuals: +5, skill: +5 },
                        log: "ğŸš² åˆ©æ½¤å¾ˆè–„ï¼Œä½†è·¯ä¸Šé¨è»Šçš„äººè®Šå¤šäº†ï¼Œå½¢è±¡åŠ åˆ†ã€‚"
                    }
                ]
            },
            {
                id: "burnout",
                category: "è·æ¥­å€¦æ€ ",
                title: "çƒå“¡ç´¯å£äº†",
                desc: "ä¸»åŠ›çƒå“¡å‡ºç¾è·æ¥­å€¦æ€  (Burnout)ã€‚è´ŠåŠ©å•†å …æŒè¦ä»–å‡ºå¸­æ±ºè³½å‰çš„æ‰€æœ‰æ´»å‹•ï¼Œä¸ç„¶å°±æ’¤è³‡ã€‚",
                icon: "fa-battery-quarter",
                choices: [
                    {
                        text: "é€¼ä»–å» (ç‚ºäº†éŒ¢)",
                        effect: { funds: +15, purists: -5, casuals: +10, skill: -25 },
                        log: "ğŸ“‰ çƒå“¡åœ¨æ±ºè³½å¾¹åº•å´©ç›¤ï¼Œè¡¨ç¾å¤±å¸¸ã€‚é›–ç„¶è³ºäº†éŒ¢ï¼Œä½†è¼¸äº†æ¯”è³½ã€‚"
                    },
                    {
                        text: "è®“ä»–ä¼‘æ¯ (ç‚ºäº†äºº)",
                        effect: { funds: -15, purists: +10, casuals: -10, skill: +15 },
                        log: "ğŸ’¤ è´ŠåŠ©å•†æ°£è·‘äº†ï¼Œä½†çƒå“¡å……é£½é›»ï¼Œåœ¨æ±ºè³½æ‰“å‡ºæ„Ÿäººè¡¨ç¾ã€‚"
                    }
                ]
            }
        ];

        // è¼ªç›¤äº‹ä»¶è³‡æ–™
        const wheelEvents = [
            { title: "ğŸŒ€ é¢±é¢¨å»¶è³½", desc: "æ¯”è³½å–æ¶ˆï¼Œé›–ç„¶æå¤±ç¥¨æˆ¿ï¼Œä½†çƒå“¡ç²å¾—å¯¶è²´ä¼‘æ¯ã€‚", effect: { funds: -10, skill: +15 }, color: "#FF8B94" },
            { title: "ğŸ’ƒ å•¦å•¦éšŠæˆ€æƒ…æ›å…‰", desc: "æµé‡å¤§çˆ†ç‚¸ï¼ä½†éƒ¨åˆ†æ­»å¿ ç²‰è¦ºå¾—çƒéšŠä¸å‹™æ­£æ¥­ã€‚", effect: { casuals: +25, purists: -15 }, color: "#FFAAA5" },
            { title: "ğŸ‘´ é˜¿å…¬èˆåœ˜çˆ†ç´…", desc: "å ´é‚Šçš„é˜¿å…¬é˜¿å¬¤è·³èˆå½±ç‰‡ç´…åˆ°åœ‹å¤–ï¼Œå½¢è±¡å¤§åŠ åˆ†ï¼", effect: { casuals: +20, funds: +5 }, color: "#FFD3B6" },
            { title: "âš–ï¸ è£åˆ¤èª¤åˆ¤ç‚ä¸Š", desc: "å…¨å ´çƒè¿·åœ˜çµä¸€è‡´ç½µè£åˆ¤ï¼Œå‡èšåŠ›æ„å¤–æå‡ã€‚", effect: { purists: +10, casuals: -5 }, color: "#DCEDC1" },
            { title: "ğŸ’¸ ç¥ç§˜é‡‘ä¸»æ–—å…§", desc: "ä¸€ä½éš±å½¢å¯Œè±ªè¦ºå¾—ä½ å€‘å¾ˆåŠªåŠ›ï¼Œè´ŠåŠ©äº†ä¸€ç­†éŒ¢ã€‚", effect: { funds: +20 }, color: "#A8E6CF" },
            { title: "ğŸŸï¸ çƒå ´åœé›»", desc: "å°·å°¬äº†ï¼æ¯”è³½ä¸­æ–·ï¼Œåªå¥½é€€ç¥¨è³ å„Ÿï¼Œé«”é©—æ¥µå·®ã€‚", effect: { funds: -15, casuals: -10 }, color: "#84D0FF" }
        ];

        // --- éŠæˆ²ç‹€æ…‹ ---
        let state = {
            funds: 50,
            purists: 50,
            casuals: 50,
            skill: 50,
            turn: 1,
            maxTurns: 10
        };

        // --- DOM å…ƒç´  ---
        const bars = {
            funds: document.getElementById('bar-funds'),
            purists: document.getElementById('bar-purists'),
            casuals: document.getElementById('bar-casuals'),
            skill: document.getElementById('bar-skill')
        };
        const turnDisplay = document.getElementById('turn-display');
        const mobileTurnDisplay = document.getElementById('mobile-turn-display');
        const logContainer = document.getElementById('log-container');
        const cardArea = {
            title: document.getElementById('card-title'),
            desc: document.getElementById('card-desc'),
            cat: document.getElementById('card-category'),
            icon: document.getElementById('bg-icon'),
            choices: document.getElementById('choices-container')
        };
        const wheelModal = document.getElementById('wheel-modal');
        const wheelResult = document.getElementById('wheel-result');
        const wheelEl = document.getElementById('wheel');
        const spinBtn = document.getElementById('spin-btn');

        // --- æ ¸å¿ƒé‚è¼¯ ---

        function initGame() {
            state = { funds: 50, purists: 50, casuals: 50, skill: 50, turn: 1, maxTurns: 10 };
            updateUI();
            nextTurn();
            document.getElementById('game-over-modal').classList.add('hidden');
            logContainer.innerHTML = '<p class="bg-indigo-50 p-2 rounded-lg border border-indigo-100 text-indigo-800 text-xs md:text-sm">ğŸ‘‹ æ­¡è¿ä¸Šä»»ï¼è«‹åœ¨ã€Œå•†æ¥­ã€èˆ‡ã€Œç«¶æŠ€ã€é–“å–å¾—å¹³è¡¡ã€‚</p>';
        }

        function updateUI() {
            for (let key in bars) {
                bars[key].style.width = `${state[key]}%`;
                // é¡è‰²è®ŠåŒ–
                if (state[key] < 20) bars[key].classList.replace('bg-' + getKeyColor(key) + '-400', 'bg-red-500');
                else bars[key].className = `bar-fill h-full bg-${getKeyColor(key)}-400 rounded-full`;
            }
            turnDisplay.innerText = state.turn;
            mobileTurnDisplay.innerText = state.turn;
        }

        function getKeyColor(key) {
            if(key === 'funds') return 'emerald';
            if(key === 'purists') return 'blue';
            if(key === 'casuals') return 'rose';
            if(key === 'skill') return 'amber';
        }

        function checkGameOver() {
            if (state.funds <= 0) return { type: 'lose', title: "ç ´ç”¢å•¦ï¼", msg: "æ²’éŒ¢è¬è¬ä¸èƒ½ï¼ŒçƒéšŠè¢«æ‹è³£äº†ã€‚", critique: "åœ¨è³‡æœ¬ä¸»ç¾©ç¤¾æœƒï¼Œæ²’æœ‰è³‡é‡‘å°±æ²’æœ‰è©±èªæ¬Šã€‚" };
            if (state.purists <= 0) return { type: 'lose', title: "å¤±å»éˆé­‚", msg: "æ­»å¿ çƒè¿·å…¨è·‘å…‰äº†ï¼ŒçƒéšŠè®Šæˆäº†é¦¬æˆ²åœ˜ã€‚", critique: "éåº¦è¿½æ±‚æ™¯è§€ï¼Œè®“é«”è‚²å¤±å»äº†æœ€ç´”ç²¹çš„ç«¶çˆ­æ„ç¾©ã€‚" };
            if (state.casuals <= 0) return { type: 'lose', title: "æ²’äººæ°£", msg: "é–€å¯ç¾…é›€ï¼Œæ²’æœ‰ç¥¨æˆ¿æ”¯æ’ï¼Œè¯ç›Ÿå€’é–‰ã€‚", critique: "è·æ¥­é‹å‹•æœ¬è³ªæ˜¯é«”é©—ç¶“æ¿Ÿï¼Œæ‹’çµ•å¤§çœ¾å°±æ˜¯æ‹’çµ•ç”Ÿå­˜ã€‚" };
            if (state.skill <= 0) return { type: 'lose', title: "æˆ°ç¸¾å´©å£", msg: "ä¸€ç›´è¼¸çƒï¼Œé€£æœ€éµçš„çƒè¿·éƒ½çœ‹ä¸ä¸‹å»äº†ã€‚", critique: "ç„¡è«–åŒ…è£å¤šå¥½ï¼Œç«¶æŠ€å¯¦åŠ›ä»ç„¶æ˜¯é«”è‚²çš„æ ¸å¿ƒã€‚" };
            if (state.turn > state.maxTurns) return { type: 'win', title: "å‚³å¥‡ç¶“ç†äºº", msg: "æ­å–œï¼ä½ æˆåŠŸåœ¨ç¾å¯¦èˆ‡ç†æƒ³ä¸­æ‰¾åˆ°äº†å¹³è¡¡ã€‚", critique: "ä½ è­‰æ˜äº†é«”è‚²æ—¢å¯ä»¥æ˜¯ç”Ÿæ„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¿¡ä»°ã€‚å®Œç¾ï¼" };
            
            return null;
        }

        function nextTurn() {
            const status = checkGameOver();
            if (status) {
                endGame(status);
                return;
            }

            // æª¢æŸ¥æ˜¯å¦è§¸ç™¼è¼ªç›¤ (æ¯3å›åˆ: 3, 6, 9)
            if (state.turn % 3 === 0 && state.turn !== 10) { 
                openWheel();
            } else {
                // ä¸€èˆ¬å›åˆï¼šéš¨æ©ŸæŠ½å¡
                const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                renderCard(scenario);
            }
        }

        function renderCard(scenario) {
            cardArea.title.innerText = scenario.title;
            cardArea.desc.innerText = scenario.desc;
            cardArea.cat.innerText = scenario.category;
            cardArea.icon.className = `fa-solid ${scenario.icon}`;
            
            cardArea.choices.innerHTML = '';
            scenario.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = "btn-action w-full bg-slate-50 hover:bg-white text-left p-3 md:p-4 rounded-xl border-2 border-slate-100 hover:border-blue-400 group flex flex-col md:flex-row md:items-center justify-between";
                
                // æç¤ºæ¨™ç±¤
                let hints = [];
                if(choice.effect.funds > 0) hints.push('<span class="bg-green-100 text-green-600 px-1.5 py-0.5 rounded text-[10px] font-bold mr-1">+è³‡é‡‘</span>');
                if(choice.effect.purists > 0) hints.push('<span class="bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded text-[10px] font-bold mr-1">+æ­»å¿ </span>');
                if(choice.effect.casuals > 0) hints.push('<span class="bg-pink-100 text-pink-600 px-1.5 py-0.5 rounded text-[10px] font-bold mr-1">+å¨›æ¨‚</span>');
                
                btn.innerHTML = `
                    <div class="font-bold text-slate-700 group-hover:text-blue-500 mb-1 md:mb-0 text-sm md:text-base">${choice.text}</div>
                    <div class="flex flex-wrap gap-1">${hints.join('')}</div>
                `;
                btn.onclick = () => handleChoice(choice);
                cardArea.choices.appendChild(btn);
            });
        }

        function handleChoice(choice) {
            applyEffects(choice.effect);
            addLog(`ç¬¬ ${state.turn} å­£`, choice.log, 'slate');
            state.turn++;
            updateUI();
            nextTurn();
        }

        function applyEffects(effects) {
            if(effects.funds) state.funds = Math.min(100, Math.max(0, state.funds + effects.funds));
            if(effects.purists) state.purists = Math.min(100, Math.max(0, state.purists + effects.purists));
            if(effects.casuals) state.casuals = Math.min(100, Math.max(0, state.casuals + effects.casuals));
            if(effects.skill) state.skill = Math.min(100, Math.max(0, state.skill + effects.skill));
        }

        function addLog(badge, text, color) {
            const entry = document.createElement('div');
            entry.className = `bg-${color}-50 p-2 rounded-lg border border-${color}-100 animate-pulse text-xs md:text-sm`;
            entry.innerHTML = `<span class="text-[10px] font-bold text-${color}-500 bg-${color}-100 px-1 rounded mr-2">${badge}</span><span class="text-slate-600">${text}</span>`;
            logContainer.insertBefore(entry, logContainer.firstChild);
        }

        // --- è¼ªç›¤é‚è¼¯ ---
        
        function openWheel() {
            wheelModal.classList.remove('hidden');
            // å¼·åˆ¶é‡ç¹ªä»¥è§¸ç™¼æ·¡å…¥
            void wheelModal.offsetWidth;
            wheelModal.classList.add('opacity-100');
            wheelResult.classList.add('hidden');
            spinBtn.disabled = false;
            spinBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            spinBtn.innerHTML = '<i class="fa-solid fa-rotate mr-2"></i> è½‰å‹•å‘½é‹ï¼';
            wheelEl.style.transform = 'rotate(0deg)';
        }

        function spinWheel() {
            spinBtn.disabled = true;
            spinBtn.classList.add('opacity-50', 'cursor-not-allowed');
            spinBtn.innerText = "å‘½é‹è½‰å‹•ä¸­...";

            // éš¨æ©Ÿé¸ä¸€å€‹äº‹ä»¶
            const eventIndex = Math.floor(Math.random() * wheelEvents.length);
            const selectedEvent = wheelEvents[eventIndex];
            
            // è¨ˆç®—è§’åº¦ (6å€‹å€å¡Šï¼Œæ¯å€‹60åº¦)
            const segmentAngle = 360 / 6;
            const randomOffset = Math.random() * 40 - 20;
            const targetRotation = 1440 + (360 - (eventIndex * segmentAngle)) + randomOffset;
            wheelEl.style.transform = `rotate(${targetRotation}deg)`;

            setTimeout(() => {
                showWheelResult(selectedEvent);
            }, 4000);
        }

        function showWheelResult(event) {
            const titleEl = document.getElementById('wheel-event-title');
            const descEl = document.getElementById('wheel-event-desc');
            
            titleEl.innerText = event.title;
            descEl.innerText = event.desc;
            wheelResult.classList.remove('hidden');
            
            applyEffects(event.effect);
            addLog('å‘½é‹äº‹ä»¶', `${event.title} - ${event.desc}`, 'indigo');
            updateUI();
        }

        function closeWheel() {
            wheelModal.classList.remove('opacity-100');
            setTimeout(() => {
                wheelModal.classList.add('hidden');
                state.turn++; // è¼ªç›¤çµæŸå¾Œæ‰é€²å…¥ä¸‹ä¸€å›åˆ
                updateUI();
                // ç¹¼çºŒä¸€èˆ¬æµç¨‹
                const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                renderCard(scenario);
            }, 300);
        }

        // --- çµæŸéŠæˆ² ---

        function endGame(status) {
            const modalEl = document.getElementById('game-over-modal');
            const endIcon = document.getElementById('end-icon');
            const endTitle = document.getElementById('end-title');
            
            modalEl.classList.remove('hidden');
            document.getElementById('end-message').innerText = status.msg;
            document.getElementById('end-critique').innerText = status.critique;
            if (status.type === 'win') {
                endIcon.innerText = "ğŸ†";
                endTitle.innerText = status.title;
                endTitle.className = "text-2xl md:text-3xl font-bold text-yellow-500 mb-2";
            } else {
                endIcon.innerText = "ğŸ˜­";
                endTitle.innerText = status.title;
                endTitle.className = "text-2xl md:text-3xl font-bold text-slate-700 mb-2";
            }
        }

        function restartGame() {
            initGame();
        }

        // å•Ÿå‹•éŠæˆ²
        initGame();

    </script>
</body>
</html>
